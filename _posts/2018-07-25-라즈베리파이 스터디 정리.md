---
layout: post
title: "라즈베리파이 날씨 API로 날씨 띄우기"
categories:
  - 라즈베리파이
tags:
  - RaspberryPi
---



# 라즈베리파이를 활용한 스마트미러로 날씨 띄우기

> 활동 날짜 : 2018년 7월 25일



스마트미러에서 날씨를 보여 주기 위해서는 Python을 활용해 날씨 정보를 수집 후 보여 주어야 합니다.

당연히 날씨 정보는 우리가 개별적으로 수집하기 어려우니 제공되는 API를 활용하여 수집해야 합니다.

2018년 7월 25일 현재, 파이썬에서 사용할 수 있는 API에는 OpenWeatherMap등 전 세계의 날씨를 다 파악할 수 있으나, 우리가 사용할 한국에서는 수집하기 어려울 것으로 보입니다.



따라서 **기상청 날씨 API**를 활용해 제작하도록 하겠습니다.



## 공공 API 발급받기



먼저 공공데이터포털에 가입해 기상청 자료의 사용신청을 합니다.

> https://www.data.go.kr

회원가입 후 검색창에 '기상청'을 검색 후 '동네예보조회서비스'를 선택합니다.





## 날씨 정보 조회하기

코드를 직접 작성해도 좋으나, 스터디 시간 관계상(실력 문제를 돌려서 말한 것..)  `[blurblah](https://github.com/blurblah)` 님의 초단기실황조회 예보용  `kma` 패키지를 활용해 작성하도록 하겠습니다.



참고 자료는 다음과 같습니다.

> https://github.com/blurblah/kma



우선 사용하고 있는 Pycharm에 kma패키지를 설치합니다.

> preference - project : {프로젝트명} - kma검색



참고 자료에 있는 코드를 입력해 보도록 하겠습니다.

```python
from kma import Weather

w = Weather('YOUR_SERVICE_KEY')
curr = w.get_current()
forecast = w.get_forecast()

print('Current temperature: {}'.format(curr.temperature))
```



결과값 : 

~~~
Current temperature: 35.7

Process finished with exit code 0
~~~



#### 참고 : SERVICE KEY IS NOT REGISTERED ERROR

API를 신청하고 바로 코드를 작성해 보면  `SERVICE KEY IS NOT REGISTERED ERROR` 가 반환될 수 있습니다.

검색해 본 결과 제공기관 서버와 약 1시간 간격으로 동기화되기 때문에, 키를 발급받아도 바로 사용할 수 없다고 합니다.

한 시간정도 이상 충분히 기다린 후에 시도해 봅시다.



### 코드 해석

위 예제는 `.temperature`를 사용해 기온을 파악합니다.

코드를 읽어보면 이 외에도 `basetime, humidity, sky, rain_drop` 를 추가로 제공합니다. 

기상청 자료에 따르면

`basetime`의 경우 관측 시간,

`humidity`의 경우 습도,

`sky`의 경우 하늘 상태(맑음 - 1, 구름 조금 - 2, 구름 많음 - 3, 흐림 - 4)

`rain drop`의 경우 강수량(mm)를 나타냅니다.



예제 : 

~~~python
from kma import Weather

w = Weather('API_key')
curr = w.get_current()
forecast = w.get_forecast()

print('현재 기온은: {}도 입니다.'.format(curr.temperature))
print('습도는: {}% 입니다.'.format(curr.humidity))
print('강수랑은: {}mm 입니다.'.format(curr.rain_drop))

if curr.sky == 1 :
    print('현재 날씨는 맑음 입니다.')
elif curr.sky == 2 :
    print('현재 날씨는 구름조금 입니다.')
elif curr.sky == 3 :
    print('현재 날씨는 구름많음 입니다.')
elif curr.sky == 4 :
    print('현재 날씨는 흐림 입니다')
else :
    print('날씨를 불러오는 중 오류 발생')
~~~



## pyQT 적용시키기(미완)

